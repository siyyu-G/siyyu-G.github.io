import{H as D,d as le,c as m,r as ie,e as s,o as f,v as N,w as t,g as e,h as n,f as H,q as E,F as T,k as F,L as pe,J as z,O as me,I as O,i as ee,z as ce,t as _e,K as ge,y as fe,D as ve,A as Y,B as Z}from"./index-Drv990fL.js";const Se=(v,I,A)=>D.get(`/admin/product/${v}/${I}?category3Id=${A}`),ye=()=>D.get("/admin/product/baseTrademark/getTrademarkList"),ae=v=>D.get("/admin/product/spuImageList/"+v),ne=v=>D.get("/admin/product/spuSaleAttrList/"+v),te=()=>D.get("/admin/product/baseSaleAttrList"),be=v=>v.id?D.post("/admin/product/updateSpuInfo",v):D.post("/admin/product/saveSpuInfo",v),Ve=v=>D.post("/admin/product/saveSkuInfo",v),ke=v=>D.get("/admin/product/findBySpuId/"+v),Ie=v=>D.delete("/admin/product/deleteSpu/"+v),Ae=le({__name:"skuForm",emits:["changeScene"],setup(v,{expose:I,emit:A}){let b=A,C=m([]),V=m([]),k=m([]),i=ie({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""}),r=m();const L=()=>{b("changeScene",{flag:0,params:""})},P=async($,d,c)=>{i.category3Id=c.category3Id,i.spuId=c.id,i.tmId=c.tmId;let _=await pe($,d,c.category3Id),h=await ne(c.id),K=await ae(c.id);C.value=_.data,V.value=h.data,k.value=K.data},y=$=>{r.value.clearSelection(),r.value.toggleRowSelection($,!0),i.skuDefaultImg=$.imgUrl},R=async()=>{i.skuAttrValueList=C.value.reduce((d,c)=>{if(c.attrIdAndValueId){let[_,h]=c.attrIdAndValueId.split(":");d.push({attrId:_,valueId:h})}return d},[]),i.skuSaleAttrValueList=V.value.reduce((d,c)=>{if(c.saleIdAndValueId){let[_,h]=c.saleIdAndValueId.split(":");d.push({saleAttrId:_,saleAttrValueId:h})}return d},[]),(await Ve(i)).code===200?(z({type:"success",message:"添加成功"}),b("changeScene",{flag:0,params:"update"})):z({type:"error",message:"添加失败"})};return I({initSkuData:P}),($,d)=>{const c=s("el-input"),_=s("el-form-item"),h=s("el-option"),K=s("el-select"),g=s("el-form"),p=s("el-table-column"),j=s("el-image"),w=s("el-button"),U=s("el-table");return f(),N(g,{"label-width":"80px",class:"demo-form-inline"},{default:t(()=>[e(_,{label:"SKU名称"},{default:t(()=>[e(c,{placeholder:"SKU名称",modelValue:n(i).skuName,"onUpdate:modelValue":d[0]||(d[0]=l=>n(i).skuName=l)},null,8,["modelValue"])]),_:1}),e(_,{label:"价格（元）"},{default:t(()=>[e(c,{modelValue:n(i).price,"onUpdate:modelValue":d[1]||(d[1]=l=>n(i).price=l),placeholder:"价格（元）",type:"number"},null,8,["modelValue"])]),_:1}),e(_,{label:"重量（克）"},{default:t(()=>[e(c,{modelValue:n(i).weight,"onUpdate:modelValue":d[2]||(d[2]=l=>n(i).weight=l),placeholder:"重量（克）",type:"number"},null,8,["modelValue"])]),_:1}),e(_,{label:"SKU描述"},{default:t(()=>[e(c,{modelValue:n(i).skuDesc,"onUpdate:modelValue":d[3]||(d[3]=l=>n(i).skuDesc=l),type:"textarea",placeholder:"SKU描述"},null,8,["modelValue"])]),_:1}),e(_,{label:"平台属性"},{default:t(()=>[e(g,{inline:!0},{default:t(()=>[(f(!0),H(T,null,E(n(C),(l,a)=>(f(),N(_,{label:l.attrName,key:l.id},{default:t(()=>[e(K,{modelValue:l.attrIdAndValueId,"onUpdate:modelValue":u=>l.attrIdAndValueId=u},{default:t(()=>[(f(!0),H(T,null,E(l.attrValueList,(u,x)=>(f(),N(h,{key:u.id,label:u.valueName,value:`${l.id}:${u.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(_,{label:"销售属性"},{default:t(()=>[e(g,{inline:!0},{default:t(()=>[(f(!0),H(T,null,E(n(V),(l,a)=>(f(),N(_,{label:l.saleAttrName,key:l.id,"label-width":"50px"},{default:t(()=>[e(K,{modelValue:l.saleIdAndValueId,"onUpdate:modelValue":u=>l.saleIdAndValueId=u},{default:t(()=>[(f(!0),H(T,null,E(l.spuSaleAttrValueList,(u,x)=>(f(),N(h,{key:u.id,label:u.saleAttrValueName,"label-width":"50px",value:`${l.id}:${u.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(_,{label:"图片名称"},{default:t(()=>[e(U,{border:"",data:n(k),ref_key:"table",ref:r},{default:t(()=>[e(p,{type:"selection",width:"80px",align:"center"}),e(p,{label:"图片"},{default:t(({row:l,$index:a})=>[e(j,{style:{width:"100px",height:"100px"},src:l.imgUrl},null,8,["src"])]),_:1}),e(p,{label:"名称",prop:"imgName"}),e(p,{label:"操作"},{default:t(({row:l,$index:a})=>[e(w,{type:"primary",size:"small",onClick:u=>y(l)},{default:t(()=>d[4]||(d[4]=[F("设置默认")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(_,null,{default:t(()=>[e(w,{type:"primary",onClick:R},{default:t(()=>d[5]||(d[5]=[F("保存")])),_:1}),e(w,{type:"primary",onClick:L},{default:t(()=>d[6]||(d[6]=[F("取消")])),_:1})]),_:1})]),_:1})}}}),Ue=["src"],xe=le({__name:"spuForm",emits:["changeScene"],setup(v,{expose:I,emit:A}){let b=A,C=m([]),V=m([]),k=m([]),i=m([]),r=m({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),L=m(!1),P=m(""),y=m(""),R=m([]);const $=()=>{b("changeScene",{flag:0,params:"update"})},d=async l=>{r.value=l;let a=await ae(l.id),u=await ne(l.id),x=await te();V.value=a.data.map(B=>({name:B.imgName,url:B.imgUrl})),k.value=u.data,i.value=x.data},c=l=>{P.value=l.url,L.value=!0},_=()=>{},h=l=>{if(l.type==="image/png"||l.type==="image/jpeg"||l.type==="image/gif"){if(l.size/1024/1024<3)return!0;z({type:"error",message:"上传文件务必小于3M"})}else z({type:"error",message:"上传文件格式务必是PNG|JPG|GIF"})},K=()=>{const[l,a]=y.value.split(":");let u={baseSaleAttrId:l,saleAttrName:a,spuSaleAttrValueList:[]};k.value.push(u),y.value=""},g=l=>{l.flag=!0,l.saleAttrValue="",ce(()=>{R.value[k.value.length-1].focus()})},p=l=>{l.flag=!1;const{baseSaleAttrId:a,saleAttrValue:u}=l;let x={baseSaleAttrId:a,saleAttrValueName:u};if((u==null?void 0:u.trim())===""){z({type:"error",message:"属性值不能为空"});return}if(l.spuSaleAttrValueList.find(G=>G.saleAttrValueName===u)){z({type:"error",message:"属性值不能重复"});return}l.spuSaleAttrValueList.push(x)},j=async()=>{r.value.spuImageList=V.value.map(a=>({imgName:a.name,imgUrl:a.respnose&&a.respnose.data||a.url})),r.value.spuSaleAttrList=k.value,(await be(r.value)).code===200?(z({type:"success",message:r.value.id?"更新成功":"添加成功"}),b("changeScene",{flag:0,params:r.value.id?"update":"add"})):(z({type:"error",message:r.value.id?"更新失败":"添加失败"}),b("changeScene",{flag:0,params:r.value.id?"update":"add"}))},w=async l=>{Object.assign(r.value,{category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),V.value=[],k.value=[],y.value="",r.value.id="",r.value.category3Id=l;let a=await ye();C.value=a.data;let u=await te();i.value=u.data},U=me(()=>i.value.filter(a=>k.value.every(u=>a.name!=u.saleAttrName)));return I({initHasSpuData:d,initAddSpu:w}),(l,a)=>{const u=s("el-input"),x=s("el-form-item"),B=s("el-option"),G=s("el-select"),S=s("Plus"),X=s("el-icon"),J=s("el-upload"),ue=s("el-dialog"),M=s("el-button"),W=s("el-table-column"),oe=s("el-tag"),se=s("el-table"),de=s("el-form");return f(),N(de,{"label-width":"100px",class:"demo-form-inline"},{default:t(()=>[e(x,{label:"SPU名称"},{default:t(()=>[e(u,{placeholder:"请你输入SPU名称",modelValue:n(r).spuName,"onUpdate:modelValue":a[0]||(a[0]=o=>n(r).spuName=o)},null,8,["modelValue"])]),_:1}),e(x,{label:"SPU品牌"},{default:t(()=>[e(G,{placeholder:"请你选择品牌",modelValue:n(r).tmId,"onUpdate:modelValue":a[1]||(a[1]=o=>n(r).tmId=o)},{default:t(()=>[(f(!0),H(T,null,E(n(C),(o,Q)=>(f(),N(B,{label:o.tmName,key:o.id,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(x,{label:"SPU描述"},{default:t(()=>[e(u,{modelValue:n(r).description,"onUpdate:modelValue":a[2]||(a[2]=o=>n(r).description=o),type:"textarea",placeholder:"请你输入描述"},null,8,["modelValue"])]),_:1}),e(x,{label:"SPU照片"},{default:t(()=>[e(J,{"file-list":n(V),"onUpdate:fileList":a[3]||(a[3]=o=>O(V)?V.value=o:V=o),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":c,"on-remove":_,"before-upload":h},{default:t(()=>[e(X,null,{default:t(()=>[e(S)]),_:1})]),_:1},8,["file-list"]),e(ue,{modelValue:n(L),"onUpdate:modelValue":a[4]||(a[4]=o=>O(L)?L.value=o:L=o)},{default:t(()=>[ee("img",{"w-full":"",src:n(P),alt:"Preview Image",style:{width:"100%",height:"100%"}},null,8,Ue)]),_:1},8,["modelValue"])]),_:1}),e(x,{label:"SPU销售属性"},{default:t(()=>[e(G,{modelValue:n(y),"onUpdate:modelValue":a[5]||(a[5]=o=>O(y)?y.value=o:y=o),placeholder:U.value.length?`还有${U.value.length}项可选`:"无可添加选项"},{default:t(()=>[(f(!0),H(T,null,E(U.value,(o,Q)=>(f(),N(B,{key:o.id,label:o.name,value:`${o.id}:${o.name}`},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),e(M,{onClick:K,disabled:!n(y),style:{"margin-left":"10px"},type:"primary",icon:"Plus"},{default:t(()=>a[6]||(a[6]=[F("添加属性")])),_:1},8,["disabled"]),e(se,{border:"",style:{"margin-top":"10px"},data:n(k)},{default:t(()=>[e(W,{label:"序号",type:"index",align:"center",width:"80px"}),e(W,{label:"销售属性名字",width:"120px",prop:"saleAttrName"}),e(W,{label:"销售属性值"},{default:t(({row:o,$index:Q})=>[(f(!0),H(T,null,E(o.spuSaleAttrValueList,(q,re)=>(f(),N(oe,{type:"primary",style:{margin:"5px"},closable:"",key:q.id,onClose:he=>o.spuSaleAttrValueList.splice(re,1)},{default:t(()=>[F(_e(q.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),o.flag?(f(),N(u,{key:0,ref:q=>n(R)[Q]=q,onBlur:q=>p(o),modelValue:o.saleAttrValue,"onUpdate:modelValue":q=>o.saleAttrValue=q,placeholder:"请你输入属性值",size:"small",style:{width:"120px"}},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(f(),N(M,{key:1,onClick:q=>g(o),type:"success",size:"small",icon:"Plus"},null,8,["onClick"]))]),_:1}),e(W,{label:"操作",width:"100px"},{default:t(({row:o,$index:Q})=>[e(M,{type:"danger",size:"small",icon:"Delete",onClick:q=>n(k).splice(Q,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(x,{label:""},{default:t(()=>[e(M,{type:"primary",onClick:j,disabled:!n(k).length},{default:t(()=>a[7]||(a[7]=[F("保存")])),_:1},8,["disabled"]),e(M,{type:"primary",onClick:$},{default:t(()=>a[8]||(a[8]=[F("取消")])),_:1})]),_:1})]),_:1})}}}),Ce={class:"demo-pagination-block"},Ne=le({__name:"index",setup(v){let I=ge(),A=m(0),b=m(1),C=m(3),V=m([]),k=m(0),i=m(),r=m(),L=m([]),P=m(!1);fe(()=>I.c3Id,()=>{I.c3Id&&y()});const y=async(g=1)=>{b.value=g;let p=await Se(b.value,C.value,I.c3Id);V.value=p.data.records,k.value=p.data.total},R=()=>{y()},$=()=>{A.value=1,i.value.initAddSpu(I.c3Id)},d=g=>{A.value=g.flag,g.params==="update"?y(b.value):y()},c=g=>{A.value=1,i.value.initHasSpuData(g)},_=g=>{A.value=2,r.value.initSkuData(I.c1Id,I.c2Id,g)},h=async g=>{let p=await ke(g.id);p.code===200&&(L.value=p.data,P.value=!0)},K=async g=>{(await Ie(g.id)).code===200?(z({type:"success",message:"删除成功"}),y(V.value.length>1?b.value:b.value-1)):z({type:"error",message:"删除失败"})};return ve(()=>{I.$reset()}),(g,p)=>{const j=s("Category"),w=s("el-button"),U=s("el-table-column"),l=s("el-popconfirm"),a=s("el-table"),u=s("el-pagination"),x=s("el-image"),B=s("el-dialog"),G=s("el-card");return f(),H(T,null,[e(j,{scene:n(A)},null,8,["scene"]),e(G,{style:{margin:"10px 0px"}},{default:t(()=>[Y(ee("div",null,[e(w,{onClick:$,type:"primary",icon:"Plus",disabled:!n(I).c3Id},{default:t(()=>p[3]||(p[3]=[F("添加SPU")])),_:1},8,["disabled"]),e(a,{"show-overflow-tooltip":"",style:{margin:"10px 0px"},border:"",data:n(V)},{default:t(()=>[e(U,{label:"序号",type:"index",width:"80px",align:"center"}),e(U,{label:"SPU名称",prop:"spuName"}),e(U,{label:"SPU描述",prop:"description"}),e(U,{label:"操作"},{default:t(({row:S,$index:X})=>[e(w,{type:"primary",size:"small",icon:"Plus",title:"添加SKU",onClick:J=>_(S)},null,8,["onClick"]),e(w,{type:"warning",size:"small",icon:"Edit",title:"修改SPU",onClick:J=>c(S)},null,8,["onClick"]),e(w,{type:"info",size:"small",icon:"View",title:"查看SKU列表",onClick:J=>h(S)},null,8,["onClick"]),e(l,{title:`你确定要删除${S.spuName}吗？`,width:"200px",onConfirm:J=>K(S)},{reference:t(()=>[e(w,{type:"danger",size:"small",icon:"Delete",title:"删除SPU"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),ee("div",Ce,[e(u,{"current-page":n(b),"onUpdate:currentPage":p[0]||(p[0]=S=>O(b)?b.value=S:b=S),"page-size":n(C),"onUpdate:pageSize":p[1]||(p[1]=S=>O(C)?C.value=S:C=S),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:n(k),onCurrentChange:y,onSizeChange:R},null,8,["current-page","page-size","total"])])],512),[[Z,n(A)===0]]),Y(e(xe,{ref_key:"spu",ref:i,onChangeScene:d},null,512),[[Z,n(A)===1]]),Y(e(Ae,{ref_key:"sku",ref:r,onChangeScene:d},null,512),[[Z,n(A)===2]]),e(B,{modelValue:n(P),"onUpdate:modelValue":p[2]||(p[2]=S=>O(P)?P.value=S:P=S),title:"SKU列表"},{default:t(()=>[e(a,{data:n(L),border:""},{default:t(()=>[e(U,{label:"SKU名字",prop:"skuName"}),e(U,{label:"SKU价格",prop:"price"}),e(U,{label:"SKU重量",prop:"weight"}),e(U,{label:"SKU图片"},{default:t(({row:S,$index:X})=>[e(x,{style:{width:"100px",height:"100px"},src:S.skuDefaultImg},null,8,["src"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})],64)}}});export{Ne as default};
