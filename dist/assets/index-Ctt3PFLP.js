import{H as _,d as ue,m as ie,c as i,r as me,C as pe,e as m,f as F,g as l,w as a,h as r,I as y,F as T,o as z,k as u,i as S,t as $,v as D,p as fe,q as ge,J as b}from"./index-Drv990fL.js";const ce=(d,R,C)=>_.get(`/admin/acl/user/${d}/${R}/?username=${C}`),ve=d=>d.id?_.put("/admin/acl/user/update",d):_.post("/admin/acl/user/save",d),ye=d=>_.get("/admin/acl/user/toAssign/"+d),be=d=>_.post("/admin/acl/user/doAssignRole",d),Ce=d=>_.delete("/admin/acl/user/remove/"+d),we=d=>_.delete("/admin/acl/user/batchRemove",{data:d}),Ve={style:{flex:"auto"}},_e={style:{flex:"auto"}},qe=ue({__name:"index",setup(d){let R=ie(),C=i(1),x=i(10),B=i(0),I=i([]),c=i(!1),f=i(!1),s=me({username:"",name:"",password:""}),N=i(),q=i([]),v=i([]),U=i(!1),A=i([]),k=i("");pe(()=>{w()});const w=async()=>{let o=await ce(C.value,x.value,k.value);o.code===200&&(B.value=o.data.total,I.value=o.data.records)},H=()=>{w()},M=()=>{Object.assign(s,{id:0,username:"",name:"",password:""}),c.value=!0},h=o=>{c.value=!0,Object.assign(s,o)},J=async()=>{await N.value.validate(),(await ve(s)).code===200?(b({type:"success",message:s.id?"更新成功":"添加成功"}),c.value=!1,window.location.reload()):b({type:"error",message:s.id?"更新失败":"添加失败"})},G=()=>{c.value=!1},K={username:[{required:!0,trigger:"blur",validator:(o,e,n)=>{console.log(e),e.trim().length>=5?n():n(new Error("用户名字至少五位"))}}],name:[{required:!0,trigger:"blur",validator:(o,e,n)=>{e.trim().length>=5?n():n(new Error("用户昵称至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(o,e,n)=>{e.trim().length>=5?n():n(new Error("用户密码至少五位"))}}]},Q=async o=>{v.value=[],f.value=!0,Object.assign(s,o);let e=await ye(o.id);e.code===200&&(q.value=e.data.allRolesList,v.value=e.data.assignRoles)},W=o=>{v.value=o?q.value:[]},X=o=>{U.value=o.length===q.value.length},Y=async()=>{let o={userId:s.id,roleIdList:v.value.map(n=>n.id)};(await be(o)).code===200?(b({type:"success",message:"分配成功"}),f.value=!1,w()):b({type:"error",message:"分配失败"})},Z=async o=>{(await Ce(o.id)).code===200?(b({type:"success",message:"删除成功"}),w()):b({type:"error",message:"删除失败"})},ee=o=>{A.value=o.map(e=>e.id)},le=async()=>{(await we(A.value)).code===200?(b({type:"success",message:"删除成功"}),w()):b({type:"error",message:"删除失败"})},te=async()=>{w()},ae=()=>{R.refresh=!R.refresh};return(o,e)=>{const n=m("el-input"),V=m("el-form-item"),p=m("el-button"),E=m("el-form"),L=m("el-card"),g=m("el-table-column"),oe=m("el-popconfirm"),re=m("el-table"),se=m("el-pagination"),j=m("el-drawer"),O=m("el-checkbox"),ne=m("el-checkbox-group");return z(),F(T,null,[l(L,{style:{height:"80px"}},{default:a(()=>[l(E,{inline:""},{default:a(()=>[l(V,{label:"用户名："},{default:a(()=>[l(n,{placeholder:"请输入用户名",modelValue:r(k),"onUpdate:modelValue":e[0]||(e[0]=t=>y(k)?k.value=t:k=t)},null,8,["modelValue"])]),_:1}),l(V,null,{default:a(()=>[l(p,{type:"primary",disabled:!r(k),onClick:te},{default:a(()=>e[13]||(e[13]=[u("搜索")])),_:1},8,["disabled"]),l(p,{type:"primary",onClick:ae},{default:a(()=>e[14]||(e[14]=[u("重置")])),_:1})]),_:1})]),_:1})]),_:1}),l(L,{style:{margin:"10px 0px"}},{default:a(()=>[l(p,{type:"primary",onClick:M},{default:a(()=>e[15]||(e[15]=[u("添加")])),_:1}),l(p,{type:"danger",onClick:le,disabled:!r(A).length},{default:a(()=>e[16]||(e[16]=[u("批量删除")])),_:1},8,["disabled"]),l(re,{onSelectionChange:ee,border:"",style:{margin:"10px 0px"},data:r(I)},{default:a(()=>[l(g,{type:"selection",width:"60px",align:"center"}),l(g,{label:"#",type:"index",width:"60px",align:"center"}),l(g,{prop:"id",label:"id",align:"center",width:"70px"}),l(g,{prop:"username",label:"用户名字",align:"center"}),l(g,{prop:"name",label:"用户名称",align:"center"}),l(g,{prop:"roleName",label:"用户角色",align:"center"}),l(g,{prop:"createTime",label:"创建时间",align:"center","show-overflow-tooltip":""}),l(g,{prop:"updateTime",label:"更新时间",align:"center","show-overflow-tooltip":""}),l(g,{label:"操作",align:"center",width:"300px"},{default:a(({row:t,$index:de})=>[l(p,{type:"primary",size:"small",icon:"User",onClick:P=>Q(t)},{default:a(()=>e[17]||(e[17]=[u("分配角色")])),_:2},1032,["onClick"]),l(p,{type:"primary",size:"small",icon:"Edit",onClick:P=>h(t)},{default:a(()=>e[18]||(e[18]=[u("编辑")])),_:2},1032,["onClick"]),l(oe,{title:`你确定要删除${t.username}吗？`,width:"200px",onConfirm:P=>Z(t)},{reference:a(()=>[l(p,{type:"primary",size:"small",icon:"Delete"},{default:a(()=>e[19]||(e[19]=[u("删除")])),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(se,{"current-page":r(C),"onUpdate:currentPage":e[1]||(e[1]=t=>y(C)?C.value=t:C=t),"page-size":r(x),"onUpdate:pageSize":e[2]||(e[2]=t=>y(x)?x.value=t:x=t),"page-sizes":[5,10,15,20],background:!0,layout:"prev, pager, next, jumper,->,sizes, total",total:r(B),onSizeChange:H,onCurrentChange:w},null,8,["current-page","page-size","total"])]),_:1}),l(j,{modelValue:r(c),"onUpdate:modelValue":e[6]||(e[6]=t=>y(c)?c.value=t:c=t),onClose:e[7]||(e[7]=t=>r(N).resetFields())},{header:a(()=>[S("h4",null,$(r(s).id?"更新用户":"添加用户"),1)]),default:a(()=>[l(E,{model:r(s),rules:K,ref_key:"formRef",ref:N},{default:a(()=>[l(V,{label:"用户姓名",prop:"username"},{default:a(()=>[l(n,{placeholder:"请输入用户姓名",modelValue:r(s).username,"onUpdate:modelValue":e[3]||(e[3]=t=>r(s).username=t)},null,8,["modelValue"])]),_:1}),l(V,{label:"用户昵称",prop:"name"},{default:a(()=>[l(n,{placeholder:"请输入用户昵称",modelValue:r(s).name,"onUpdate:modelValue":e[4]||(e[4]=t=>r(s).name=t)},null,8,["modelValue"])]),_:1}),r(s).id?fe("",!0):(z(),D(V,{key:0,label:"用户密码",prop:"password"},{default:a(()=>[l(n,{placeholder:"请输入用户密码",modelValue:r(s).password,"onUpdate:modelValue":e[5]||(e[5]=t=>r(s).password=t)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:a(()=>[S("div",Ve,[l(p,{type:"primary",onClick:G},{default:a(()=>e[20]||(e[20]=[u("取消")])),_:1}),l(p,{type:"primary",onClick:J},{default:a(()=>e[21]||(e[21]=[u("确定")])),_:1})])]),_:1},8,["modelValue"]),l(j,{modelValue:r(f),"onUpdate:modelValue":e[12]||(e[12]=t=>y(f)?f.value=t:f=t)},{header:a(()=>e[22]||(e[22]=[S("h4",null,"分配角色用户",-1)])),default:a(()=>[l(E,null,{default:a(()=>[l(V,{label:"用户姓名"},{default:a(()=>[l(n,{modelValue:r(s).username,"onUpdate:modelValue":e[8]||(e[8]=t=>r(s).username=t),disabled:!0},null,8,["modelValue"])]),_:1}),l(V,{label:"角色列表"},{default:a(()=>[l(O,{style:{"margin-right":"40px"},modelValue:r(U),"onUpdate:modelValue":e[9]||(e[9]=t=>y(U)?U.value=t:U=t),onChange:W},{default:a(()=>e[23]||(e[23]=[u("全选")])),_:1},8,["modelValue"]),l(ne,{modelValue:r(v),"onUpdate:modelValue":e[10]||(e[10]=t=>y(v)?v.value=t:v=t),onChange:X},{default:a(()=>[(z(!0),F(T,null,ge(r(q),(t,de)=>(z(),D(O,{key:t.id,label:t},{default:a(()=>[u($(t.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:a(()=>[S("div",_e,[l(p,{onClick:e[11]||(e[11]=t=>y(f)?f.value=!1:f=!1)},{default:a(()=>e[24]||(e[24]=[u("取消")])),_:1}),l(p,{type:"primary",onClick:Y},{default:a(()=>e[25]||(e[25]=[u("保存")])),_:1})])]),_:1},8,["modelValue"])],64)}}});export{qe as default};
