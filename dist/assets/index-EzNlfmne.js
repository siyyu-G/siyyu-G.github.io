import{H as C,d as ee,m as le,c as u,r as te,C as ae,e as d,f as oe,g as l,w as t,h as r,I as x,F as re,o as ne,k as m,i as j,z as O,J as b}from"./index-Drv990fL.js";const se=(n,v,g)=>C.get(`/admin/acl/role/${n}/${v}?roleName=${g}`),ie=n=>n.id?C.put("/admin/acl/role/update",n):C.post("/admin/acl/role/save",n),de=n=>C.get("/admin/acl/permission/toAssign/"+n),ue=(n,v)=>C.post(`/admin/acl/permission/doAssign/?roleId=${n}&permission=${v}`),pe=n=>C.delete("/admin/acl/role/remove/"+n),me={style:{flex:"auto"}},ye=ee({__name:"index",setup(n){let v=le(),g=u(1),w=u(10),R=u(0),S=u([]),_=u(""),f=u(!1),s=te({id:"",roleName:""}),N=u(),c=u(!1),V=u([]);const T={children:"children",label:"name"};let A=u([]),U=u();ae(()=>{y()});const y=async()=>{let o=await se(g.value,w.value,_.value);o.code===200&&(S.value=o.data.records,R.value=o.data.total)},B=async()=>{y()},I=()=>{v.refresh=!v.refresh},D=()=>{f.value=!1},F=()=>{Object.assign(s,{id:"",roleName:""}),O(()=>{N.value.clearValidate("roleName")}),f.value=!0},H=o=>{f.value=!0,O(()=>{N.value.clearValidate("roleName")}),Object.assign(s,o)},L=async()=>{await N.value.validate(),(await ie(s)).code===200?(f.value=!1,b({type:"success",message:s.id?"编辑成功":"添加成功"}),y()):b({type:"error",message:s.id?"编辑失败":"添加失败"})},M={roleName:[{required:!0,trigger:"blur",validator:(o,e,i)=>{e.trim().length>=2?i():i(new Error("职位名称至少两位"))}}]},J=async o=>{c.value=!0,Object.assign(s,o);let e=await de(s.id);e.code===200&&(V.value=e.data,A.value=q(V.value,[]))},q=(o,e)=>(o.forEach(i=>{i.select&&i.level===4&&e.push(i.id),i.children&&i.children.length>0&&q(i.children,[])}),e),K=async()=>{let o=U.value.getCheckedKeys();(await ue(s.id,o)).code===200?(b({type:"success",message:"分配成功"}),y()):b({type:"error",message:"分配失败"})},G=async o=>{(await pe(o.id)).code===200?(b({type:"success",message:"删除成功"}),y()):b({type:"error",message:"删除失败"})};return(o,e)=>{const i=d("el-input"),z=d("el-form-item"),p=d("el-button"),P=d("el-form"),$=d("el-card"),k=d("el-table-column"),Q=d("el-popconfirm"),W=d("el-table"),X=d("el-pagination"),Y=d("el-dialog"),Z=d("el-tree"),h=d("el-drawer");return ne(),oe(re,null,[l($,{style:{height:"80px"}},{default:t(()=>[l(P,{inline:""},{default:t(()=>[l(z,{label:"角色名称："},{default:t(()=>[l(i,{placeholder:"角色名称",modelValue:r(_),"onUpdate:modelValue":e[0]||(e[0]=a=>x(_)?_.value=a:_=a)},null,8,["modelValue"])]),_:1}),l(z,null,{default:t(()=>[l(p,{type:"primary",disabled:!r(_),onClick:B},{default:t(()=>e[7]||(e[7]=[m("搜索")])),_:1},8,["disabled"]),l(p,{type:"primary",onClick:I},{default:t(()=>e[8]||(e[8]=[m("重置")])),_:1})]),_:1})]),_:1})]),_:1}),l($,{style:{margin:"10px 0px"}},{default:t(()=>[l(p,{type:"primary",icon:"Plus",onClick:F},{default:t(()=>e[9]||(e[9]=[m("添加角色")])),_:1}),l(W,{border:"",style:{margin:"10px 0px"},data:r(S)},{default:t(()=>[l(k,{type:"index",label:"#",width:"80px",align:"center"}),l(k,{prop:"id",label:"ID",width:"150px",align:"center"}),l(k,{prop:"roleName",label:"角色名称",align:"center"}),l(k,{prop:"createTime",label:"创建时间",align:"center",width:"200px"}),l(k,{prop:"updateTime",label:"更新时间",align:"center",width:"200px"}),l(k,{label:"操作",align:"center",width:"300px"},{default:t(({row:a,$index:ce})=>[l(p,{type:"primary",icon:"User",size:"small",onClick:E=>J(a)},{default:t(()=>e[10]||(e[10]=[m("分配权限")])),_:2},1032,["onClick"]),l(p,{type:"primary",icon:"Edit",size:"small",onClick:E=>H(a)},{default:t(()=>e[11]||(e[11]=[m("编辑")])),_:2},1032,["onClick"]),l(Q,{title:`你确定要删除${a.roleName}吗？`,onConfirm:E=>G(a)},{reference:t(()=>[l(p,{type:"primary",icon:"Delete",size:"small"},{default:t(()=>e[12]||(e[12]=[m("删除")])),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(X,{"current-page":r(g),"onUpdate:currentPage":e[1]||(e[1]=a=>x(g)?g.value=a:g=a),"page-size":r(w),"onUpdate:pageSize":e[2]||(e[2]=a=>x(w)?w.value=a:w=a),"page-sizes":[5,10,15,20],background:!0,layout:"prev, pager, next, jumper,->,sizes, total",total:r(R),onSizeChange:y,onCurrentChange:y},null,8,["current-page","page-size","total"])]),_:1}),l(Y,{title:r(s).id?"编辑角色":"添加角色",modelValue:r(f),"onUpdate:modelValue":e[4]||(e[4]=a=>x(f)?f.value=a:f=a)},{footer:t(()=>[l(p,{type:"primary",onClick:D},{default:t(()=>e[13]||(e[13]=[m("取消")])),_:1}),l(p,{type:"primary",onClick:L},{default:t(()=>e[14]||(e[14]=[m("确定")])),_:1})]),default:t(()=>[l(P,{model:r(s),rules:M,ref_key:"form",ref:N},{default:t(()=>[l(z,{label:"角色名称",prop:"roleName"},{default:t(()=>[l(i,{placeholder:"请填写角色名称",modelValue:r(s).roleName,"onUpdate:modelValue":e[3]||(e[3]=a=>r(s).roleName=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(h,{modelValue:r(c),"onUpdate:modelValue":e[6]||(e[6]=a=>x(c)?c.value=a:c=a)},{header:t(()=>e[15]||(e[15]=[j("h4",null,"分配权限",-1)])),default:t(()=>[l(Z,{ref_key:"tree",ref:U,style:{"max-width":"600px"},data:r(V),"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":r(A),props:T},null,8,["data","default-checked-keys"])]),footer:t(()=>[j("div",me,[l(p,{onClick:e[5]||(e[5]=a=>x(c)?c.value=!1:c=!1)},{default:t(()=>e[16]||(e[16]=[m("取消")])),_:1}),l(p,{type:"primary",onClick:K},{default:t(()=>e[17]||(e[17]=[m("确认")])),_:1})])]),_:1},8,["modelValue"])],64)}}});export{ye as default};
